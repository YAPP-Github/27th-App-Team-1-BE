name: Notify Discord

on:
  workflow_call:
    inputs:
      title:
        required: true
        type: string
      description:
        required: true
        type: string
      url:
        required: true
        type: string
      color:
        required: true
        type: number
      fields:
        required: false
        type: string
        default: '[]'
    secrets:
      DISCORD_WEBHOOK:
        required: true

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Notification
        continue-on-error: true
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          TITLE: ${{ inputs.title }}
          DESCRIPTION: ${{ inputs.description }}
          URL: ${{ inputs.url }}
          COLOR: ${{ inputs.color }}
          FIELDS: ${{ inputs.fields }}
        run: |
          PAYLOAD=$(jq -n \
            --arg title "$TITLE" \
            --arg description "$DESCRIPTION" \
            --arg url "$URL" \
            --argjson color "$COLOR" \
            --argjson fields "$FIELDS" \
            '{embeds: [{title: $title, description: $description, url: $url, color: $color, fields: $fields}]}')

          curl -H "Content-Type: application/json" -X POST "$DISCORD_WEBHOOK" -d "$PAYLOAD"
