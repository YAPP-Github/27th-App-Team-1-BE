name: Discord Notification

on:
  pull_request:
    types: [opened, closed]
  pull_request_review:
    types: [submitted]
  workflow_run:
    workflows: ["Deploy DEV", "Deploy LIVE"]
    types: [completed]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: PR Opened
        if: github.event_name == 'pull_request' && github.event.action == 'opened'
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          curl -H "Content-Type: application/json" -X POST "$DISCORD_WEBHOOK" -d '{
            "embeds": [{
              "title": "ğŸ”” ìƒˆë¡œìš´ PR",
              "description": "**[#${{ github.event.pull_request.number }}] ${{ github.event.pull_request.title }}**",
              "url": "${{ github.event.pull_request.html_url }}",
              "color": 3447003,
              "fields": [
                {"name": "ì‘ì„±ì", "value": "${{ github.event.pull_request.user.login }}", "inline": true},
                {"name": "ë¸Œëœì¹˜", "value": "`${{ github.event.pull_request.head.ref }}` â†’ `${{ github.event.pull_request.base.ref }}`", "inline": true}
              ]
            }]
          }'

      - name: PR Merged
        if: github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == true
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          curl -H "Content-Type: application/json" -X POST "$DISCORD_WEBHOOK" -d '{
            "embeds": [{
              "title": "âœ… PR ë³‘í•© ì™„ë£Œ",
              "description": "**[#${{ github.event.pull_request.number }}] ${{ github.event.pull_request.title }}**",
              "url": "${{ github.event.pull_request.html_url }}",
              "color": 5763719,
              "fields": [
                {"name": "ì‘ì„±ì", "value": "${{ github.event.pull_request.user.login }}", "inline": true},
                {"name": "ë³‘í•©ì", "value": "${{ github.event.pull_request.merged_by.login }}", "inline": true},
                {"name": "ë¸Œëœì¹˜", "value": "`${{ github.event.pull_request.head.ref }}` â†’ `${{ github.event.pull_request.base.ref }}`", "inline": false}
              ]
            }]
          }'

      - name: PR Approved
        if: github.event_name == 'pull_request_review' && github.event.review.state == 'approved'
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          curl -H "Content-Type: application/json" -X POST "$DISCORD_WEBHOOK" -d '{
            "embeds": [{
              "title": "ğŸ‘ PR ìŠ¹ì¸",
              "description": "**[#${{ github.event.pull_request.number }}] ${{ github.event.pull_request.title }}**",
              "url": "${{ github.event.pull_request.html_url }}",
              "color": 3066993,
              "fields": [
                {"name": "ë¦¬ë·°ì–´", "value": "${{ github.event.review.user.login }}", "inline": true},
                {"name": "ì‘ì„±ì", "value": "${{ github.event.pull_request.user.login }}", "inline": true}
              ]
            }]
          }'

      - name: PR Changes Requested
        if: github.event_name == 'pull_request_review' && github.event.review.state == 'changes_requested'
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          curl -H "Content-Type: application/json" -X POST "$DISCORD_WEBHOOK" -d '{
            "embeds": [{
              "title": "ğŸ”„ ìˆ˜ì • ìš”ì²­",
              "description": "**[#${{ github.event.pull_request.number }}] ${{ github.event.pull_request.title }}**",
              "url": "${{ github.event.pull_request.html_url }}",
              "color": 15105570,
              "fields": [
                {"name": "ë¦¬ë·°ì–´", "value": "${{ github.event.review.user.login }}", "inline": true},
                {"name": "ì‘ì„±ì", "value": "${{ github.event.pull_request.user.login }}", "inline": true}
              ]
            }]
          }'

      - name: Deploy Success
        if: github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'success'
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          curl -H "Content-Type: application/json" -X POST "$DISCORD_WEBHOOK" -d '{
            "embeds": [{
              "title": "ğŸš€ ë°°í¬ ì„±ê³µ",
              "description": "**${{ github.event.workflow_run.name }}**",
              "url": "${{ github.event.workflow_run.html_url }}",
              "color": 5763719,
              "fields": [
                {"name": "ë¸Œëœì¹˜", "value": "`${{ github.event.workflow_run.head_branch }}`", "inline": true},
                {"name": "ì»¤ë°‹", "value": "`${{ github.event.workflow_run.head_sha }}`", "inline": true}
              ]
            }]
          }'

      - name: Deploy Failure
        if: github.event_name == 'workflow_run' && github.event.workflow_run.conclusion == 'failure'
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          curl -H "Content-Type: application/json" -X POST "$DISCORD_WEBHOOK" -d '{
            "embeds": [{
              "title": "âŒ ë°°í¬ ì‹¤íŒ¨",
              "description": "**${{ github.event.workflow_run.name }}**",
              "url": "${{ github.event.workflow_run.html_url }}",
              "color": 15158332,
              "fields": [
                {"name": "ë¸Œëœì¹˜", "value": "`${{ github.event.workflow_run.head_branch }}`", "inline": true},
                {"name": "ì»¤ë°‹", "value": "`${{ github.event.workflow_run.head_sha }}`", "inline": true}
              ]
            }]
          }'
